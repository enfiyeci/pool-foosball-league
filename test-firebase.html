<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #output { white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Firebase Connection Test</h1>

    <div id="status">Initializing...</div>

    <h2>Actions</h2>
    <button onclick="testWrite()">Test Write to Firebase</button>
    <button onclick="testRead()">Test Read from Firebase</button>
    <button onclick="checkData()">Check Current Data</button>

    <h2>Output</h2>
    <div id="output"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCAzEpgCp_F6M7tmXn4Llo-FtPyQVUf0Mo",
            authDomain: "elmo-pool-tourney.firebaseapp.com",
            databaseURL: "https://elmo-pool-tourney-default-rtdb.firebaseio.com",
            projectId: "elmo-pool-tourney",
            storageBucket: "elmo-pool-tourney.firebasestorage.app",
            messagingSenderId: "502645327724",
            appId: "1:502645327724:web:073c94fad8585e52b09549",
            measurementId: "G-Z58QE2HRGY"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Make available globally
        window.firebaseDB = { database, ref, set, get, onValue };
        window.firebaseReady = true;

        log('Firebase initialized successfully', 'success');
        document.getElementById('status').textContent = 'Firebase Ready!';
        document.getElementById('status').className = 'log success';

        // Test functions
        window.testWrite = async function() {
            log('Testing write operation...');
            const testData = {
                id: Date.now(),
                mode: 'pool-1v1',
                type: '1v1',
                timestamp: new Date().toISOString(),
                winners: ['Test Player 1'],
                losers: ['Test Player 2'],
                eloChanges: {
                    'Test Player 1': 16,
                    'Test Player 2': -16
                }
            };

            try {
                // Try writing to a test path first
                await set(ref(database, 'test/match'), testData);
                log('Write to test/match successful!', 'success');

                // Now try writing to matchHistory
                const matchHistory = [testData];
                await set(ref(database, 'matchHistory'), matchHistory);
                log('Write to matchHistory successful!', 'success');
            } catch (err) {
                log('Write error: ' + err.message, 'error');
                console.error(err);
            }
        };

        window.testRead = async function() {
            log('Testing read operation...');
            try {
                const snapshot = await get(ref(database, 'matchHistory'));
                const data = snapshot.val();
                log('Read successful! Data: ' + JSON.stringify(data, null, 2), 'success');
            } catch (err) {
                log('Read error: ' + err.message, 'error');
                console.error(err);
            }
        };

        window.checkData = async function() {
            log('Checking all data...');
            try {
                const snapshot = await get(ref(database, '/'));
                const data = snapshot.val();
                log('Database contents:\n' + JSON.stringify(data, null, 2).substring(0, 2000) + '...', 'success');
            } catch (err) {
                log('Check error: ' + err.message, 'error');
                console.error(err);
            }
        };

        function log(message, type = '') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            output.insertBefore(div, output.firstChild);
        }
        window.log = log;
    </script>
</body>
</html>
